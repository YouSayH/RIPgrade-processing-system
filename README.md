# 成績処理ツール (RIPgrade Processing System)

## 概要

**成績処理ツール**は、学校の教員向けに開発されたデスクトップアプリケーションです。CSV形式の成績データを読み込み、指定されたExcelファイルに転記・集計する一連の作業を自動化します。

このツールは、手作業による転記ミスを防ぎ、定型的な事務作業の負担を大幅に軽減することを目的としています。GUI（グラフィカル・ユーザー・インターフェース）を採用しており、プログラミングの知識がない方でも直感的に操作できます。

## 主な機能

  * **多彩なデータ処理:**
      * **成績一覧の更新:** CSVの成績データ（本試、再試など）を、指定したExcelシート（前期・通期）に自動で転記・更新します。
      * **評定一覧の作成:** 生徒ごとの評定をまとめた新しいシートを自動生成します。
      * **出席状況一覧の作成:** 科目ごとの欠席・遅刻・早退状況をまとめた、見やすい2段ヘッダーのシートを自動生成します。
  * **直感的な操作性:**
      * **GUI操作:** ファイルの選択から処理の実行まで、すべての操作をマウスで行えます。
      * **ドラッグ＆ドロップ対応:** CSVファイルとExcelファイルをウィンドウに直接ドラッグ＆ドロップして指定できます。
      * **進捗表示:** 処理の進捗状況がプログレスバーで表示され、現在の状況をリアルタイムで確認できます。
  * **堅牢なエラーハンドリング:**
      * **入力ファイルの事前検証:** ファイル形式（文字コード、ヘッダー構造）の誤りや、必須項目（氏名など）の欠落を検知し、分かりやすいメッセージで通知します。
      * **実行時エラーへの対応:** ファイルが他のプログラムで開かれている、ディスク容量が不足しているといった実行時の問題も検知し、処理を安全に中断します。
      * **ログ出力:** 発生したエラーの詳細を `error.log` ファイルに記録し、問題解決をサポートします。

## 使い方

1.  **アプリケーションの起動:**
    `main.py` を実行すると、メインウィンドウが表示されます。

2.  **ファイルの指定:**

      * **方法1: 参照ボタン**
          * 「① CSVファイル」エリアの「参照...」ボタンを押し、成績データが記載されたCSVファイルを選択します。
          * 「② Excelファイル」エリアの「参照...」ボタンを押し、転記先となるExcelファイルを選択します。
      * **方法2: ドラッグ＆ドロップ**
          * CSVファイルとExcelファイルをウィンドウ内に直接ドラッグ＆ドロップします。

3.  **実行する処理の選択:**

      * 「③ 実行する処理を選択」エリアで、実行したいタスク（「成績一覧を更新」「評定一覧を作成」など）にチェックを入れます。
      * 「成績一覧を更新」を選択した場合は、「④ 成績一覧の対象学期」で対象となる学期（「前期」「通期」）も選択してください。

4.  **処理の開始:**

      * 「実行開始」ボタンをクリックすると、処理が始まります。
      * 処理中は「処理状況」エリアにログが表示され、プログレスバーが進捗を示します。

5.  **完了:**

      * 処理が正常に完了すると、メッセージボックスで通知されます。
      * エラーが発生した場合は、その理由がメッセージボックスに表示されます。

## ファイル形式の仕様

本ツールが正しく動作するためには、入力ファイルが以下の仕様に準拠している必要があります。

### CSVファイル

  * **文字コード:** **Shift-JIS (cp932)** である必要があります。
  * **ヘッダー:** **2行で構成される**必要があります。
      * **1行目:** 科目名（例: 数学, 英語）や、単独の項目名（例: 備考, 総点）を記述します。
      * **2行目:** データの種別（例: 本試, 再試, 評, 欠, 遅, 早）を記述します。
  * **必須列:**
      * **学籍番号:** 最初の列に配置する必要があります。
      * **氏名:** 2行目のヘッダーが `config.py` で定義された `KEY_STUDENT_NAME`（デフォルト: "氏名"）である列が必須です。

### Excelファイル (転記先)

  * **シート名:** 「成績一覧を更新」機能を使用する場合、`config.py` で定義された命名規則に従ったシートが予め存在している必要があります。（例: `成績一覧 (前期)`）
  * **ヘッダー:** 成績一覧シートは、特定の構造（4行ヘッダー）を前提としています。詳細は `repositories/excel_repository.py` の `_map_subject_columns` メソッドを参照してください。

## プロジェクト構造

```
ripgrade-processing-system/
│
├── .gitignore
├── config.py               # 設定値（キーワード、シート名など）
├── main.py                 # アプリケーションのエントリーポイント
├── requirements.txt        # 依存ライブラリ
├── utils.py                # 補助関数（Excelのスタイル調整など）
│
├── models/
│   ├── __init__.py
│   └── student.py          # データモデル（Studentクラス）とCSV読み込みロジック
│
├── repositories/
│   └── excel_repository.py   # Excelファイルの読み書き（永続化）ロジック
│
├── services/
│   ├── __init__.py
│   ├── summary_service.py    # 各種集計シートの作成ロジック
│   ├── task_runner.py      # 全タスクの統括・実行管理
│   └── transfer_service.py   # 成績転記処理のロジック
│
└── ui/
    ├── __init__.py
    ├── view.py             # UIの見た目（View）の定義
    └── viewmodel.py        # UIの動作と状態（ViewModel）の管理
```

## 依存ライブラリ

このアプリケーションは、以下の外部ライブラリに依存しています。`requirements.txt` からインストールできます。

  * pandas
  * openpyxl
  * tkinterdnd2
  * (その他、`requirements.txt` に記載されているライブラリ)

**実行コマンド:**

```bash
pip install -r requirements.txt
```

-----
